# ESPHome Sensor Node Template
# Basic multi-sensor node with I2C and GPIO

substitutions:
  device_name: office-sensor
  friendly_name: "Office Sensor"
  update_interval: 60s

esphome:
  name: ${device_name}
  friendly_name: ${friendly_name}

esp32:
  board: esp32dev
  framework:
    type: arduino

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  ap:
    ssid: "${device_name} Fallback"
    password: !secret fallback_password

captive_portal:

api:
  encryption:
    key: !secret api_key

ota:
  - platform: esphome
    password: !secret ota_password

logger:
  level: INFO

# I2C bus for sensors
i2c:
  sda: GPIO21
  scl: GPIO22
  scan: true

# Environmental sensors
sensor:
  # BME280 Temperature/Humidity/Pressure
  - platform: bme280_i2c
    temperature:
      name: "${friendly_name} Temperature"
      oversampling: 16x
      filters:
        - offset: -1.0  # Calibration offset
    pressure:
      name: "${friendly_name} Pressure"
    humidity:
      name: "${friendly_name} Humidity"
    address: 0x76
    update_interval: ${update_interval}

  # Light level (BH1750)
  - platform: bh1750
    name: "${friendly_name} Illuminance"
    address: 0x23
    update_interval: ${update_interval}

  # WiFi signal strength
  - platform: wifi_signal
    name: "${friendly_name} WiFi Signal"
    update_interval: 300s

  # Uptime
  - platform: uptime
    name: "${friendly_name} Uptime"

# Motion sensor
binary_sensor:
  - platform: gpio
    pin:
      number: GPIO4
      mode: INPUT_PULLUP
    name: "${friendly_name} Motion"
    device_class: motion
    filters:
      - delayed_off: 30s
    on_press:
      - homeassistant.event:
          event: esphome.motion_detected
          data:
            location: "${friendly_name}"

  # Connection status
  - platform: status
    name: "${friendly_name} Status"

# Status LED
light:
  - platform: status_led
    name: "${friendly_name} Status LED"
    pin:
      number: GPIO2
      inverted: true

# Device info
text_sensor:
  - platform: wifi_info
    ip_address:
      name: "${friendly_name} IP"
    ssid:
      name: "${friendly_name} SSID"

# Restart button
button:
  - platform: restart
    name: "${friendly_name} Restart"
