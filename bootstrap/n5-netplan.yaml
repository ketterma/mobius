# Netplan configuration for N5 VLAN interfaces
# Location: /etc/netplan/01-netcfg.yaml (on N5 host)
# Apply with: sudo netplan apply
#
# IMPORTANT: VLAN interfaces need IP addresses for proper routing
# - VLAN 1 (untagged on enp197s0): Required for host connectivity and VLAN 1 LoadBalancers
# - VLAN 8 (enp197s0.8): Required for routing to LoadBalancers in services pool
# - VLAN 16 (enp197s0.16): Required for routing to future sandbox workloads
#
# Without IP addresses, MetalLB LoadBalancer IPs won't be accessible from other networks
# because the kernel can't route packets arriving on the VLAN interface.

network:
  version: 2
  renderer: networkd

  ethernets:
    # 10G NIC - primary interface with untagged VLAN 1 (Infra)
    enp197s0:
      dhcp4: false
      dhcp6: false
      addresses:
        - 192.168.4.5/24
      routes:
        - to: default
          via: 192.168.4.1
      nameservers:
        addresses:
          - 192.168.4.53  # AdGuard Home DNS
          - 1.1.1.1       # Cloudflare fallback

    # 5G NIC - for IoT bridge
    eno1:
      dhcp4: false
      dhcp6: false

  vlans:
    # VLAN 8 - Infrastructure VIPs (MetalLB LoadBalancers)
    enp197s0.8:
      id: 8
      link: enp197s0
      addresses:
        - 192.168.8.254/24  # Required for routing to LoadBalancers

    # VLAN 16 - Sandbox/Untrusted (future use)
    enp197s0.16:
      id: 16
      link: enp197s0
      addresses:
        - 192.168.16.254/20  # Required for routing to future workloads

    # VLAN 64 - IoT (for bridge)
    eno1.64:
      id: 64
      link: eno1
      # No IP - will be added to bridge64

  bridges:
    # Bridge for IoT VLAN (Home Assistant VM)
    bridge64:
      interfaces:
        - eno1.64
      addresses:
        - 192.168.64.1/20
      parameters:
        stp: false
        forward-delay: 0
